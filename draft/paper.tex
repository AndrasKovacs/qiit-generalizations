
\documentclass{llncs}

\usepackage{proof}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage[utf8]{inputenc}
\usepackage{todonotes}
\input{abbrevs.tex}

%% abbrevs
%% ------------------------------------------------------------

\newcommand{\Lift}{\Uparrow}

%% ------------------------------------------------------------

\begin{document}

\title{Generalizations of Quotient Inductive-Inductive Types\thanks{This work
    was supported by EFOP-3.6.3-VEKOP-16-2017-00002 grant and COST
    Action EUTypes CA15123.}}

\author{Ambrus Kaposi \and Andr{\'a}s Kov{\'a}cs}
\institute{E{\"o}tv{\"o}s Lor{\'a}nd University, Budapest, Hungary \\ \{akaposi$|$kovacsandras\}@inf.elte.hu}

\maketitle

\begin{abstract}
Quotient inductive-inductive types (QIITs) are generalized inductive types which
allow sorts to be indexed over previously declared sorts, and allow usage of
equality constructors. QIITs are especially useful for algebraic descriptions of
type theories and constructive definitions of real, ordinal and surreal
numbers. We develop new metatheory for large QIITs, large elimination, recursive
equations, infinitary constructors and equations between sorts.
%% First, we develop tools which allow precise and convenient handling
%% of universe levels, working internally in an extensional type theory with
%% cumulative universes.
As in prior work, we describe QIITs using a type theory where each context
represents a QIIT signature. However, in our case the theory of signatures can
also describe its own signature. We use self-description to bootstrap a model
theory for the theory of signatures without using preterms or assuming a
pre-existing internal syntax for a type theory. We give initial algebra
semantics for described QIITs, and we show the equivalence of initiality and
induction. We present two extensions of a previous term model construction. The
first one constructs all large infinitary QIITs without sort equations from the
QIIT of the theory of signatures. The second one constructs all large finitary
QIITs with sort equations, from the same syntax. This separation is required
because handling infinitary constructors in the term model requires showing a
strong form of invariance under algebra isomorphisms, which is violated by sort
equations.

\end{abstract}

\section{Introduction}
\label{sec:intro}

\todo[inline]{Citations}

The aim of this work is to provide theoretical underpinning to a general notion
of inductive types, called quotient inductive-inductive types (QIITs). QIITs are
of interest because there are many commonly used mathematical structures, which
can be conveniently described as QIITs in type theory, but cannot be defined as
less general inductive types, or doing so incurs large encoding overhead.

Categories are a good example. Signatures for QIITs allow having multiple sorts,
with later ones indexed over previous ones, and equations as well. We need both
features in order to write down the signature of categories:
\begin{alignat*}{5}
  & Obj && : \Set \\
  & Mor && : Obj \ra Obj \ra \Set \\
  & id  && : Mor\,i\,j \\
  & \blank\circ\blank && : Mor\,j\,k\ra Mor\,i\,j \ra Mor\,i\,k \\
  & idl && : id \circ f = f \\
  & idr && : f \circ id = f \\
  & ass && : f \circ (g \circ h) = (f \circ g) \circ h
\end{alignat*}
The benefit of having a QIIT signature is getting a model theory ``for free'',
from the metatheory of QIITs. This model theory includes a category of algebras
which has an initial object and also some additional structure. For the
signature of categories, we get the empty category as the initial object, but it
is common to consider categories with more structure, which have more
interesting initial models.

Algebraic notions of models of type theories are examples for this. Here,
initial models represent syntax, and initiality corresponds to induction on
syntax. A number of different notions have been used, from contextual categories
and comprehension categories to categories with families, but all of these are
categories with extra structure.

The main motivation of the current paper is to extend QIITs so that it
accommodates all algebraic notions of type theories which have been used in
previous works. As a beneficial side effect of fulfilling this goal, infinitary
QIITs such as real numbers will be covered as well.

We generalize previous notions of QIITs in the following ways:
\begin{enumerate}
  \item
  \textbf{Large constructors, large elimination} and models at different
  universe levels. This feature is routinely used in the metatheory of type
  theory, but it has not been presented explicitly in previous works about
  QIITs. In order to handle universe levels gracefully, we develop a set of
  tools, working inside an extensional type theory with \emph{algebraic
    cumulativity}.
  \item
  \textbf{Infinitary constructors}. This enables defining Cauchy real numbers
  and surreal numbers as QIITs. Also, the theory of QIIT signatures is itself
  large and infinitary, thus it can ``eat itself'', i.e.\ include its own
  signature and provide its own metatheory.  We use this self-representation to
  bootstrap the model theory of signatures, without having to assume any
  pre-existing internal syntax.
  \item
  \textbf{Recursive equations}, i.e. equations appearing as assumptions
  of constructors. These have occurred previously in syntaxes of cubical type
  theories, as boundary conditions.
  \item
  \textbf{Sort equations}, or equations between type constructors. They have
  been used recently to conveniently represent type-theoretic universes, for
  example Russell-style universes or cumulative hierarchies.
\end{enumerate}

We also develop semantics. We show that for each signature, there is a cwf
(category with families) of algebras, extended with $\Sigma$-types, an
extensional identity type and constant families. This additional structure
corresponds to a type-theoretic flavor of finite limits, and it was shown
in \cite{TODO} that the category of such cwfs is biequivalent to the category
of finitely complete categories.

As to the existence of initial algebras, we present two different term model
constructions, yielding the following statements:

\begin{enumerate}
\item
  All large infinitary QIITs with recursive equations, but \emph{without
  sort equations}, are reducible to the theory of signatures, i.e.\
  their initial algebras are constructible from the initial algebra for
  the theory of signatures.
\item
  All large finitary QIITs with sort equations, but no recursive equations,
  are reducible to the theory of signatures.
\end{enumerate}

The reason for the two separate constructions is that sort equations are not as
well-behaved as the other extensions: they are modelled as strict equalities of
sets in algebras, and so they do not respect isomorphism of sets. We make
essential use of invariance under set isomorphism in the first term model
construction, so we cannot throw sort equations into that mix.

In Section \ref{sec:levels} we set up cumulative universes which we use in later
sections. In Section \ref{sec:tos} we introduce the theory of QIIT
signatures. In Section \ref{sec:cwfmodel} we develop initial algebra semantics,
also covering the theory of signatures itself. In Sections
\ref{sec:infinitary_term}-\ref{sec:sort_term} we present the two term model
constructions. We discuss related work and conclusions in Sections
\ref{sec:related}-\ref{sec:conclusion}.


\section{Cumulative Extensional Type Theory}
\label{sec:levels}

In the following sections, we will consider QIIT algebras at arbitrary finite
levels, along with large eliminations, where the initial algebra can be at a
different level than the target algebra. For a simple example, consider natural
number algebras at a given level $i$, given as the $\Sigma$-type $NatAlg_i :\equiv(Nat :
\Set_i)\times Nat\times(Nat \ra Nat)$. The initial such algebra is the set of
natural numbers, which is at level $0$, but in type theory we often want to
eliminate into larger $\Set_i$, for example when computing a $Nat$-indexed family
of types.

Universe levels are usually viewed as a bureaucratic and tedious part of type
theory, and are often omitted or mentioned only in passing. Here we intend to
model universe levels in a precise way, because large eliminations are an
essential part of the practical usage of inductive types. Hence, we need a way
to conveniently reason about levels without overmuch administrative
burden. Unfortunately, simple universe setups are insufficient for this
purpose. We need two features: cumulativity and a way to quantify over finite
levels.

\subsection{Cumulativity}

Cumulativity makes handling of algebras and constructions at different levels
much easier. For example, given an algebra $\gamma : NatAlg_i$, cumulativity
allows us to also have $\gamma : NatAlg_{i+j}$. In a non-cumulative setting such
as Agda, we may only have for each type $A : \Set_i$ a type $\mathsf{Lift}_{i\,j}\,A :
\Set_{i+j}$ which is isomorphic to $A$ up to definitional equality.

In the most basic form, cumulativity requires that whenever $A : \Set_i$, then
also $A : \Set_{i+j+1}$. However, the $NatAlg$ example above also required a form
of cumulativity for $\Sigma$ and $\Pi$ types, and we need this in general for
QIIT algebras.

We use Sterling's cumulative algebraic type theory \cite{TODO} as the general
setting for the rest of the paper. The reason for this is twofold. First, it
supports the right kind of cumulativity for our purposes. Second, it is itself a
finitary QIIT with sort equations, hence its model theory is covered in this
paper\footnote{Which is, of course, somewhat circular, but not more circular than
  e.g.\ the study of models of ZFC in ZFC.}.

We extend the base theory with an extensional identity type and
$\Sigma$-types. In \cite{TODO} a proof of canonicity is provided for the base
theory, which also includes a standard set-theoretic model. It is
straightforward to extend the canonicity proof to cover our additional type
formers.

From now on, we refer to this theory as cETT (cumulative extensional type
theory). When working in cETT, we use conventional type-theoretic notation. We
have Russell-style universes $\Set_i$ indexed by natural numbers, dependent
functions as $(x : A)\ra B$, and dependent pairs as $(x : A)\times B$ with
projections $\proj1$ and $\proj2$. We also have a \emph{lifting} operation on
types, which introduces cumulativity. The most important rules for lifting are
the following:

\begin{figure}

Universe formation
\[
  \infer{\Gamma \vdash \Set_i : \Set_{i+j+1}}{}
\]

Type lifting
\[
%% \begin{gathered}
  \infer{\Gamma \vdash\,\Lift_j A : \Set_{i+j+1}}
        {\Gamma \vdash A : \Set_i}
%% \end{gathered}
\]
Universe lifting
\[
  \Lift_j Set_i = Set_{i+j}
\]
Term lifting
\[
\{t\,|\,\Gamma \vdash t : A\} = \{t\,|\,\Gamma \vdash t :\,\,\Lift_j A\}
\]
Context lifting
\[
(\Gamma,\,x : A) = (\Gamma,\,x :\,\Lift_j A)
\]
Function lifting
\[
\Lift_j((x : A)\ra B) = (x :\,\Lift_j A)\ra\,\Lift_j B
\]
Pair lifting
\[
\Lift_j((x : A)\times B) = (x :\,\Lift_j A)\,\times\Lift_j B
\]

\caption{Some of the rules for lifting}
\label{lifting}
\end{figure}

In Figure \ref{lifting}, we include an excerpt of Sterling's rules, with a
slight change of presentation. We use $i+j+1$ levels instead of assuming $i < j$
and lifting to $\Set_j$. We also omit rules for naturality and substitution of
lifting. In general, we can expect that lifting never impedes constructions,
because it appropriately computes out of the way.

Of special note is the \emph{term lifting rule}. It is a sort equation, an
equation between sets of terms, expressing that lifted types have exactly the
same terms as unlifted ones. This allows us to have $t :\,\,\Lift_j A$ whenever $t
: A$. Together with the universe lifting rule, this implies $A : Set_{i+j+1}$
whenever $A : Set_i$. Similarly, the lifting rules for functions and pairs give
us cumulativity for $NatAlg$.





\section{Theory of Signatures}
\label{sec:tos}

\subsection{Bootstrapping}

\section{Categories with Families of Algebras}
\label{sec:cwfmodel}

\section{Infinitary Term Models}
\label{sec:infinitary_term}

\subsection{Preservation of Isomorphisms}

\section{Term Models for Sort Equations}
\label{sec:sort_term}

\section{Related Work}
\label{sec:related}

\section{Conclusion}
\label{sec:conclusion}


\bibliography{references}

\end{document}
